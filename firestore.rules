rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * Core Philosophy: This ruleset establishes a "Public Read / Admin Write" model.
     * The application's purpose is to display a catalog of dramas, which is public.
     * All write operations (create, update, delete) are restricted to authenticated
     * users (admins) to protect data integrity.
     */

    // Helper Functions
    /**
     * isSignedIn
     * @description Checks if a user is authenticated.
     * @returns {boolean} True if the user has a valid auth object.
     */
    function isSignedIn() {
      return request.auth != null;
    }


    /**
     * @description Rules for the 'dramas' collection.
     * @path /dramas/{dramaId}
     * @allow (read) Any user, authenticated or not, can read/list dramas.
     * @allow (write) Only signed-in users (admins) can create, update, or delete dramas.
     */
    match /dramas/{dramaId} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    /**
     * @description Rules for the 'genres' collection.
     * @path /genres/{genreId}
     * @allow (read) Any user, authenticated or not, can read/list genres.
     * @allow (write) Only signed-in users (admins) can create, update, or delete genres.
     */
    match /genres/{genreId} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    /**
     * @description Rules for the 'parts' collection.
     * @path /parts/{partId}
     * @allow (read) Any user, authenticated or not, can read/list parts.
     * @allow (write) Only signed-in users (admins) can create, update, or delete parts.
     */
    match /parts/{partId} {
      // Public read access is granted to all users to view episode lists.
      allow read: if true;
      allow write: if isSignedIn();
    }
  }
}
